<template>
  <require from="/styles/chat.css"></require>
  <require from="./valueconverters/formattime"></require>
  <require from="./valueconverters/formatpost"></require>
  <link rel="stylesheet" href="/styles/chat-${theme}.css">
  <div id="chatContainer" class="chatContainer">
    <div id="postContainer" class="postContainer">
      <ul style="list-style-type: none; padding: 0px; margin: 0px;">
        <li class="post" style="" repeat.for="post of posts">
          <div class="postHeader">
            <span class="time">${post.posted | formatTime}</span>
            <span class="name">${post.name}</span>
          </div>
          <div class="postBody">
          <a if.bind="post.image" class="image" href.bind="post.image.url" click.trigger="$parent.toggleImage(post)">
            <img class="thumbnail" src.bind="post.showFullImage ? post.image.url : post.image.thumbUrl" title.bind="post.image.originalFilename">
          </a>
          <span class="comment" innerHTML.bind="post.comment | formatPost"></span>
          </div>
        </li>
      </ul>
    </div>

    <div id="chatControls" class="chatControls">
      <form id="postForm" submit.delegate="submitPost()">
        <table class="postTable">
          <tr>
            <td>Name</td>
            <td><input name="name" type="text" value.bind="post.name" placeholder="Anonymous" disabled.bind="postingDisabled"></td>
          </tr>
          <tr>
            <td>Comment</td>
            <td><textarea name="comment" value.bind="post.comment" maxlength="600" class="postMessageTextarea" wrap="soft" disabled.bind="postingDisabled"></textarea></td>
          </tr>
          <tr>
            <td>Image</td>
            <td><input name="image" type="file" accept="image/*" change.delegate="imageSelected($event)" disabled.bind="postingDisabled"></td>
          </tr>
          <tr>
            <td></td>
            <td>
              <button type="submit" disabled.bind="postingDisabled">Post</button>
              <span class="progress">${postingProgress}</span>
            </td>
          </tr>
        </table>
      </form>
      <div class="options">
        <select value.bind="theme" change.delegate="themeSelected()">
          <option repeat.for="theme of themes" value.bind="theme.name">${theme.description}</option>
        </select>
        <button type="button" name="themeSelector"><span class="fa fa-wrench"></span></button>
      </div>
    </div>
  </div>
</template>
